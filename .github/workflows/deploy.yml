- name: Restart last run if none are running (schedule only)
  if: github.event_name == 'schedule'
  uses: actions/github-script@v7
  with:
    script: |
      const { owner, repo } = context.repo;

      // اسم ملف الـ workflow الصحيح
      const workflow_id = "deploy.yml";

      const runs = await github.rest.actions.listWorkflowRuns({
        owner,
        repo,
        workflow_id,
        per_page: 10
      });

      const running = runs.data.workflow_runs.find(r => r.status === "in_progress" || r.status === "queued");

      if (running) {
        core.info("هناك تشغيل حالياً... لن يتم تشغيل أي شيء.");
        return;
      }

      const lastRun = runs.data.workflow_runs[0];
      if (!lastRun) {
        core.info("لا توجد أي عمليات سابقة لإعادة تشغيلها.");
        return;
      }

      core.info(`إعادة تشغيل آخر Run: ${lastRun.id}`);
      await github.rest.actions.reRunWorkflow({
        owner,
        repo,
        run_id: lastRun.id
      });

      core.info("تمت عملية إعادة التشغيل بنجاح.");
      process.exit(0);